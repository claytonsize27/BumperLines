<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Bumper Pool Odds</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 40px auto;
      padding: 20px;
      background: #f7f9fc;
      color: #333;
      border-radius: 12px;
      box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
    }
    h1 {
      text-align: center;
      color: #111;
    }
    label {
      font-weight: bold;
      display: block;
      margin-top: 20px;
    }
    input[type="text"], select {
      width: 100%;
      padding: 10px;
      margin-top: 5px;
      margin-bottom: 15px;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    .radio-group {
      display: flex;
      gap: 20px;
      margin-top: 5px;
    }
    .radio-group label {
      font-weight: normal;
    }
    button {
      background-color: #007bff;
      color: white;
      padding: 12px;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    #results {
      background: #fff;
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 6px;
      margin-top: 20px;
      white-space: pre-wrap;
    }
    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 10px;
    }
    table, th, td {
      border: 1px solid #ddd;
    }
    th, td {
      text-align: center;
      padding: 8px;
    }
    th {
      background-color: #f1f1f1;
    }
  </style>
</head>
<body>
  <h1>üé± Bumper Pool Predictor</h1>
  <form id="predict-form">
    <label for="playerA">Player A (breaking):</label>
    <input type="text" name="playerA" required />

    <label for="playerB">Player B:</label>
    <input type="text" name="playerB" required />

    <label>Which side is Player A breaking from?</label>
    <div class="radio-group">
      <label><input type="radio" name="break_side" value="Window Side" checked /> Window Side</label>
      <label><input type="radio" name="break_side" value="TV Side" /> TV Side</label>
    </div>

    <label>Are the players inebriated?</label>
    <div class="radio-group">
      <label><input type="radio" name="inebriated" value="Yes" checked /> Yes</label>
      <label><input type="radio" name="inebriated" value="No" /> No</label>
    </div>

    <label><input type="checkbox" name="vig" /> Include Vig</label><br><br>

    <button type="submit">Calculate Odds</button>
  </form>

  <div id="results"></div>

  <script>
    const form = document.getElementById("predict-form");
    const results = document.getElementById("results");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      results.textContent = "Loading odds...";
      const formData = new FormData(form);
      const params = new URLSearchParams();

      for (const [key, value] of formData.entries()) {
        if (key === "vig") {
          params.append("vig", "true");
        } else {
          params.append(key, value);
        }
      }

      const url = "https://bumper-pool-api.onrender.com/predict?" + params.toString();

      try {
        const res = await fetch(url);
        if (!res.ok) throw new Error(`API responded with status ${res.status}`);
        const data = await res.json();

        const pA = Object.keys(data.moneyline)[0];
        const pB = Object.keys(data.moneyline)[1];
        const probA = data.moneyline.probabilities[pA];
        const probB = data.moneyline.probabilities[pB];
        const mlA = data.moneyline[pA];
        const mlB = data.moneyline[pB];
        const sweepA = data.sweep_odds[pA];
        const sweepB = data.sweep_odds[pB];
        const winner = data.predicted_margin.winner;
        const loser = data.predicted_margin.loser;
        const margin = data.predicted_margin.margin;

        let marginHTML = `
        <h3>üéØ Win Margin Odds for ${winner}</h3>
        <table>
          <tr><th>Wins by</th><th>Probability</th><th>Odds</th></tr>
        `;

        for (const [balls, entry] of Object.entries(data.margin_distribution)) {
          marginHTML += `<tr><td>${balls} balls</td><td>${(entry.probability * 100).toFixed(1)}%</td><td>${entry.odds}</td></tr>`;
        }
        marginHTML += `</table>`;

        results.innerHTML = `
<b>Results:</b><br><br>
<b>${pA}</b> has a ${(probA * 100).toFixed(1)}% chance to win (Moneyline: ${mlA})<br>
<b>${pB}</b> has a ${(probB * 100).toFixed(1)}% chance to win (Moneyline: ${mlB})<br><br>

<b>Predicted Margin:</b><br>
<b>${winner}</b> is expected to beat <b>${loser}</b> by <b>${margin} balls</b>.<br><br>

<b>Sweep Odds (win 5-0):</b><br>
<b>${pA}</b>: ${sweepA}<br>
<b>${pB}</b>: ${sweepB}<br><br>

${marginHTML}
        `;
      } catch (err) {
        results.textContent = "‚ùå Error: " + err.message;
      }
    });
  </script>
</body>
</html>
